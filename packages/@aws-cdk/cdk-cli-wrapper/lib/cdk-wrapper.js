"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CdkCliWrapper = void 0;
const commands_1 = require("./commands");
const utils_1 = require("./utils");
/**
 * Provides a programmatic interface for interacting with the CDK CLI by
 * wrapping the CLI with exec
 */
class CdkCliWrapper {
    constructor(options) {
        this.directory = options.directory;
        this.env = options.env;
        this.showOutput = options.showOutput ?? false;
        try {
            this.cdk = options.cdkExecutable ?? 'cdk';
        }
        catch {
            throw new Error(`could not resolve path to cdk executable: "${options.cdkExecutable ?? 'cdk'}"`);
        }
    }
    validateArgs(options) {
        if (!options.stacks && !options.all) {
            throw new Error('one of "app" or "stacks" must be provided');
        }
    }
    async list(options) {
        const listCommandArgs = [
            ...renderBooleanArg('long', options.long),
            ...this.createDefaultArguments(options),
        ];
        return (0, utils_1.exec)([this.cdk, 'ls', ...listCommandArgs], {
            cwd: this.directory,
            verbose: this.showOutput,
            env: this.env,
        }).split('\n');
    }
    /**
     * cdk deploy
     */
    async deploy(options) {
        const deployCommandArgs = [
            ...renderBooleanArg('ci', options.ci),
            ...renderBooleanArg('execute', options.execute),
            ...renderBooleanArg('exclusively', options.exclusively),
            ...renderBooleanArg('force', options.force),
            ...renderBooleanArg('previous-parameters', options.usePreviousParameters),
            ...renderBooleanArg('rollback', options.rollback),
            ...renderBooleanArg('staging', options.staging),
            ...options.reuseAssets ? renderArrayArg('--reuse-assets', options.reuseAssets) : [],
            ...options.notificationArns ? renderArrayArg('--notification-arns', options.notificationArns) : [],
            ...options.parameters ? renderMapArrayArg('--parameters', options.parameters) : [],
            ...options.outputsFile ? ['--outputs-file', options.outputsFile] : [],
            ...options.requireApproval ? ['--require-approval', options.requireApproval] : [],
            ...options.changeSetName ? ['--change-set-name', options.changeSetName] : [],
            ...options.toolkitStackName ? ['--toolkit-stack-name', options.toolkitStackName] : [],
            ...options.progress ? ['--progress', options.progress] : ['--progress', commands_1.StackActivityProgress.EVENTS],
            ...options.deploymentMethod ? ['--method', options.deploymentMethod] : [],
            ...options.concurrency ? ['--concurrency', options.concurrency.toString()] : [],
            ...this.createDefaultArguments(options),
        ];
        (0, utils_1.exec)([this.cdk, 'deploy', ...deployCommandArgs], {
            cwd: this.directory,
            verbose: this.showOutput,
            env: this.env,
        });
    }
    async watch(options, events = {}) {
        let hotswap;
        switch (options.hotswap) {
            case commands_1.HotswapMode.FALL_BACK:
                hotswap = '--hotswap-fallback';
                break;
            case commands_1.HotswapMode.HOTSWAP_ONLY:
                hotswap = '--hotswap';
                break;
            default:
                hotswap = '--hotswap-fallback';
                break;
        }
        const deployCommandArgs = [
            '--watch',
            ...renderBooleanArg('ci', options.ci),
            ...renderBooleanArg('execute', options.execute),
            ...renderBooleanArg('exclusively', options.exclusively),
            ...renderBooleanArg('force', options.force),
            ...renderBooleanArg('previous-parameters', options.usePreviousParameters),
            ...renderBooleanArg('rollback', options.rollback),
            ...renderBooleanArg('staging', options.staging),
            ...renderBooleanArg('logs', options.traceLogs),
            hotswap,
            ...options.reuseAssets ? renderArrayArg('--reuse-assets', options.reuseAssets) : [],
            ...options.notificationArns ? renderArrayArg('--notification-arns', options.notificationArns) : [],
            ...options.parameters ? renderMapArrayArg('--parameters', options.parameters) : [],
            ...options.outputsFile ? ['--outputs-file', options.outputsFile] : [],
            ...options.requireApproval ? ['--require-approval', options.requireApproval] : [],
            ...options.changeSetName ? ['--change-set-name', options.changeSetName] : [],
            ...options.toolkitStackName ? ['--toolkit-stack-name', options.toolkitStackName] : [],
            ...options.progress ? ['--progress', options.progress] : ['--progress', commands_1.StackActivityProgress.EVENTS],
            ...options.deploymentMethod ? ['--method', options.deploymentMethod] : [],
            ...this.createDefaultArguments(options),
        ];
        const child = (0, utils_1.watch)([this.cdk, 'deploy', ...deployCommandArgs], {
            cwd: this.directory,
            verbose: this.showOutput,
            env: this.env,
        });
        if (events.onStdout) {
            child.stdout?.on('data', events.onStdout);
        }
        if (events.onStderr) {
            child.stderr?.on('data', events.onStderr);
        }
        child.on('close', (code) => {
            child.stdin?.end();
            if (events.onClose) {
                events.onClose(code);
            }
        });
    }
    /**
     * cdk destroy
     */
    async destroy(options) {
        const destroyCommandArgs = [
            ...renderBooleanArg('force', options.force),
            ...renderBooleanArg('exclusively', options.exclusively),
            ...this.createDefaultArguments(options),
        ];
        (0, utils_1.exec)([this.cdk, 'destroy', ...destroyCommandArgs], {
            cwd: this.directory,
            verbose: this.showOutput,
            env: this.env,
        });
    }
    /**
     * cdk synth
     */
    async synth(options) {
        const synthCommandArgs = [
            ...renderBooleanArg('validation', options.validation),
            ...renderBooleanArg('quiet', options.quiet),
            ...renderBooleanArg('exclusively', options.exclusively),
            ...this.createDefaultArguments(options),
        ];
        (0, utils_1.exec)([this.cdk, 'synth', ...synthCommandArgs], {
            cwd: this.directory,
            verbose: this.showOutput,
            env: this.env,
        });
    }
    /**
     * Do a CDK synth, mimicking the CLI (without actually using it)
     *
     * The CLI has a pretty slow startup time because of all the modules it needs to load,
     * Bypass it to be quicker!
     */
    async synthFast(options) {
        (0, utils_1.exec)(options.execCmd, {
            cwd: this.directory,
            verbose: this.showOutput,
            env: {
                CDK_CONTEXT_JSON: JSON.stringify(options.context),
                CDK_OUTDIR: options.output,
                ...this.env,
                ...options.env,
            },
        });
    }
    createDefaultArguments(options) {
        this.validateArgs(options);
        const stacks = options.stacks ?? [];
        return [
            ...options.app ? ['--app', options.app] : [],
            ...renderBooleanArg('strict', options.strict),
            ...renderBooleanArg('trace', options.trace),
            ...renderBooleanArg('lookups', options.lookups),
            ...renderBooleanArg('ignore-errors', options.ignoreErrors),
            ...renderBooleanArg('json', options.json),
            ...renderBooleanArg('verbose', options.verbose),
            ...renderBooleanArg('debug', options.debug),
            ...renderBooleanArg('ec2creds', options.ec2Creds),
            ...renderBooleanArg('version-reporting', options.versionReporting),
            ...renderBooleanArg('path-metadata', options.pathMetadata),
            ...renderBooleanArg('asset-metadata', options.assetMetadata),
            ...renderBooleanArg('notices', options.notices),
            ...renderBooleanArg('color', options.color),
            ...options.context ? renderMapArrayArg('--context', options.context) : [],
            ...options.profile ? ['--profile', options.profile] : [],
            ...options.proxy ? ['--proxy', options.proxy] : [],
            ...options.caBundlePath ? ['--ca-bundle-path', options.caBundlePath] : [],
            ...options.roleArn ? ['--role-arn', options.roleArn] : [],
            ...options.output ? ['--output', options.output] : [],
            ...stacks,
            ...options.all ? ['--all'] : [],
        ];
    }
}
exports.CdkCliWrapper = CdkCliWrapper;
function renderMapArrayArg(flag, parameters) {
    const params = [];
    for (const [key, value] of Object.entries(parameters)) {
        params.push(`${key}=${value}`);
    }
    return renderArrayArg(flag, params);
}
function renderArrayArg(flag, values) {
    let args = [];
    for (const value of values ?? []) {
        args.push(flag, value);
    }
    return args;
}
function renderBooleanArg(val, arg) {
    if (arg) {
        return [`--${val}`];
    }
    else if (arg === undefined) {
        return [];
    }
    else {
        return [`--no-${val}`];
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2RrLXdyYXBwZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjZGstd3JhcHBlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSx5Q0FBZ0U7QUFDaEUsbUNBQXNDO0FBaUl0Qzs7O0dBR0c7QUFDSCxNQUFhLGFBQWE7SUFNeEIsWUFBWSxPQUE2QjtRQUN2QyxJQUFJLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUM7UUFDbkMsSUFBSSxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxVQUFVLEdBQUcsT0FBTyxDQUFDLFVBQVUsSUFBSSxLQUFLLENBQUM7UUFDOUMsSUFBSSxDQUFDO1lBQ0gsSUFBSSxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUMsYUFBYSxJQUFJLEtBQUssQ0FBQztRQUM1QyxDQUFDO1FBQUMsTUFBTSxDQUFDO1lBQ1AsTUFBTSxJQUFJLEtBQUssQ0FBQyw4Q0FBOEMsT0FBTyxDQUFDLGFBQWEsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ25HLENBQUM7SUFDSCxDQUFDO0lBRU8sWUFBWSxDQUFDLE9BQTBCO1FBQzdDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ3BDLE1BQU0sSUFBSSxLQUFLLENBQUMsMkNBQTJDLENBQUMsQ0FBQztRQUMvRCxDQUFDO0lBQ0gsQ0FBQztJQUVNLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBb0I7UUFDcEMsTUFBTSxlQUFlLEdBQWE7WUFDaEMsR0FBRyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQztZQUN6QyxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxPQUFPLENBQUM7U0FDeEMsQ0FBQztRQUVGLE9BQU8sSUFBQSxZQUFJLEVBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLGVBQWUsQ0FB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TUFBTSxHQUFhLEVBQUUsQ0FBQztJQUM1QixLQUFLLE1BQU0sQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDO1FBQ3RELE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksS0FBSyxFQUFFLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBQ0QsT0FBTyxjQUFjLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQ3RDLENBQUM7QUFFRCxTQUFTLGNBQWMsQ0FBQyxJQUFZLEVBQUUsTUFBaUI7SUFDckQsSUFBSSxJQUFJLEdBQWEsRUFBRSxDQUFDO0lBQ3hCLEtBQUssTUFBTSxLQUFLLElBQUksTUFBTSxJQUFJLEVBQUUsRUFBRSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFDRCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUM7QUFFRCxTQUFTLGdCQUFnQixDQUFDLEdBQVcsRUFBRSxHQUFhO0lBQ2xELElBQUksR0FBRyxFQUFFLENBQUM7UUFDUixPQUFPLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3RCLENBQUM7U0FBTSxJQUFJLEdBQUcsS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUM3QixPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7U0FBTSxDQUFDO1FBQ04sT0FBTyxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN6QixDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgRGVmYXVsdENka09wdGlvbnMsIERlc3Ryb3lPcHRpb25zIH0gZnJvbSAnQGF3cy1jZGsvY2xvdWQtYXNzZW1ibHktc2NoZW1hL2xpYi9pbnRlZy10ZXN0cyc7XG5pbXBvcnQgdHlwZSB7IFN5bnRoT3B0aW9ucywgTGlzdE9wdGlvbnMsIERlcGxveU9wdGlvbnMgfSBmcm9tICcuL2NvbW1hbmRzJztcbmltcG9ydCB7IFN0YWNrQWN0aXZpdHlQcm9ncmVzcywgSG90c3dhcE1vZGUgfSBmcm9tICcuL2NvbW1hbmRzJztcbmltcG9ydCB7IGV4ZWMsIHdhdGNoIH0gZnJvbSAnLi91dGlscyc7XG5cbmV4cG9ydCB0eXBlIFdhdGNoRXZlbnRzID0ge1xuICBvblN0ZG91dD86IChjaHVuazogYW55KSA9PiB2b2lkO1xuICBvblN0ZGVycj86IChjaHVuazogYW55KSA9PiB2b2lkO1xuICBvbkNsb3NlPzogKGNvZGU6IG51bWJlciB8IG51bGwpID0+IHZvaWQ7XG59O1xuXG4vKipcbiAqIEFXUyBDREsgQ0xJIG9wZXJhdGlvbnNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJQ2RrIHtcblxuICAvKipcbiAgICogY2RrIGRlcGxveVxuICAgKi9cbiAgZGVwbG95KG9wdGlvbnM6IERlcGxveU9wdGlvbnMpOiBQcm9taXNlPHZvaWQ+O1xuXG4gIC8qKlxuICAgKiBjZGsgc3ludGhcbiAgICovXG4gIHN5bnRoKG9wdGlvbnM6IFN5bnRoT3B0aW9ucyk6IFByb21pc2U8dm9pZD47XG5cbiAgLyoqXG4gICAqIGNkayBkZXN0cm95XG4gICAqL1xuICBkZXN0cm95KG9wdGlvbnM6IERlc3Ryb3lPcHRpb25zKTogUHJvbWlzZTx2b2lkPjtcblxuICAvKipcbiAgICogY2RrIGxpc3RcbiAgICovXG4gIGxpc3Qob3B0aW9uczogTGlzdE9wdGlvbnMpOiBQcm9taXNlPHN0cmluZ1tdPjtcblxuICAvKipcbiAgICogY2RrIHN5bnRoIGZhc3RcbiAgICovXG4gIHN5bnRoRmFzdChvcHRpb25zOiBTeW50aEZhc3RPcHRpb25zKTogUHJvbWlzZTx2b2lkPjtcblxuICAvKipcbiAgICogY2RrIHdhdGNoXG4gICAqL1xuICB3YXRjaChvcHRpb25zOiBEZXBsb3lPcHRpb25zLCBldmVudHM/OiBXYXRjaEV2ZW50cyk6IFByb21pc2U8dm9pZD47XG59XG5cbi8qKlxuICogT3B0aW9ucyBmb3Igc3ludGhpbmcgYW5kIGJ5cGFzc2luZyB0aGUgQ0RLIENMSVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFN5bnRoRmFzdE9wdGlvbnMge1xuICAvKipcbiAgICogVGhlIGNvbW1hbmQgdG8gdXNlIHRvIGV4ZWN1dGUgdGhlIGFwcC5cbiAgICogVGhpcyBpcyB0eXBpY2FsbHkgdGhlIHNhbWUgdGhpbmcgdGhhdCBub3JtYWxseVxuICAgKiBnZXRzIHBhc3NlZCB0byBgLS1hcHBgXG4gICAqXG4gICAqIGUuZy4gXCJub2RlICdiaW4vbXktYXBwLnRzJ1wiXG4gICAqIG9yICdnbyBydW4gbWFpbi5nbydcbiAgICovXG4gIHJlYWRvbmx5IGV4ZWNDbWQ6IHN0cmluZ1tdO1xuXG4gIC8qKlxuICAgKiBFbWl0cyB0aGUgc3ludGhlc2l6ZWQgY2xvdWQgYXNzZW1ibHkgaW50byBhIGRpcmVjdG9yeVxuICAgKlxuICAgKiBAZGVmYXVsdCBjZGsub3V0XG4gICAqL1xuICByZWFkb25seSBvdXRwdXQ/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgY29udGV4dFxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIGFkZGl0aW9uYWwgY29udGV4dFxuICAgKi9cbiAgcmVhZG9ubHkgY29udGV4dD86IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG5cbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgZW52aXJvbm1lbnQgdmFyaWFibGVzIHRvIHNldCBpbiB0aGVcbiAgICogZXhlY3V0aW9uIGVudmlyb25tZW50XG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm8gYWRkaXRpb25hbCBlbnZcbiAgICovXG4gIHJlYWRvbmx5IGVudj86IHsgcmVhZG9ubHkgW25hbWU6IHN0cmluZ106IHN0cmluZyB9O1xufVxuXG4vKipcbiAqIEFkZGl0aW9uYWwgZW52aXJvbm1lbnQgdmFyaWFibGVzIHRvIHNldCBpbiB0aGUgZXhlY3V0aW9uIGVudmlyb25tZW50XG4gKlxuICogQGRlcHJlY2F0ZWQgVXNlIHJhdyBwcm9wZXJ0eSBiYWdzIGluc3RlYWQgKG9iamVjdCBsaXRlcmFscywgYE1hcDxTdHJpbmcsT2JqZWN0PmAsIGV0Yy4uLiApXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRW52aXJvbm1lbnQge1xuICAvKipcbiAgICogVGhpcyBpbmRleCBzaWduYXR1cmUgaXMgbm90IHVzYWJsZSBpbiBub24tVHlwZVNjcmlwdC9KYXZhU2NyaXB0IGxhbmd1YWdlcy5cbiAgICpcbiAgICogQGpzaWkgaWdub3JlXG4gICAqL1xuICBba2V5OiBzdHJpbmddOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogQVdTIENESyBjbGllbnQgdGhhdCBwcm92aWRlcyBhbiBBUEkgdG8gcHJvZ3JhbWF0aWNhbGx5IGV4ZWN1dGUgdGhlIENESyBDTElcbiAqIGJ5IHdyYXBwaW5nIGNhbGxzIHRvIGV4ZWMgdGhlIENMSVxuICovXG5leHBvcnQgaW50ZXJmYWNlIENka0NsaVdyYXBwZXJPcHRpb25zIHtcbiAgLyoqXG4gICAqIFRoZSBkaXJlY3RvcnkgdG8gcnVuIHRoZSBjZGsgY29tbWFuZHMgZnJvbVxuICAgKi9cbiAgcmVhZG9ubHkgZGlyZWN0b3J5OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgZW52aXJvbm1lbnQgdmFyaWFibGVzIHRvIHNldFxuICAgKiBpbiB0aGUgZXhlY3V0aW9uIGVudmlyb25tZW50IHRoYXQgd2lsbCBiZSBydW5uaW5nXG4gICAqIHRoZSBjZGsgY29tbWFuZHNcbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBhZGRpdGlvbmFsIGVudiB2YXJzXG4gICAqL1xuICByZWFkb25seSBlbnY/OiB7IFtuYW1lOiBzdHJpbmddOiBzdHJpbmcgfTtcblxuICAvKipcbiAgICogVGhlIHBhdGggdG8gdGhlIGNkayBleGVjdXRhYmxlXG4gICAqXG4gICAqIEBkZWZhdWx0ICdhd3MtY2RrL2Jpbi9jZGsnXG4gICAqL1xuICByZWFkb25seSBjZGtFeGVjdXRhYmxlPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBTaG93IHRoZSBvdXRwdXQgZnJvbSBydW5uaW5nIHRoZSBDREsgQ0xJXG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICByZWFkb25seSBzaG93T3V0cHV0PzogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBQcm92aWRlcyBhIHByb2dyYW1tYXRpYyBpbnRlcmZhY2UgZm9yIGludGVyYWN0aW5nIHdpdGggdGhlIENESyBDTEkgYnlcbiAqIHdyYXBwaW5nIHRoZSBDTEkgd2l0aCBleGVjXG4gKi9cbmV4cG9ydCBjbGFzcyBDZGtDbGlXcmFwcGVyIGltcGxlbWVudHMgSUNkayB7XG4gIHByaXZhdGUgcmVhZG9ubHkgZGlyZWN0b3J5OiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgZW52PzogeyBbbmFtZTogc3RyaW5nXTogc3RyaW5nIHwgdW5kZWZpbmVkIH07XG4gIHByaXZhdGUgcmVhZG9ubHkgY2RrOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgc2hvd091dHB1dDogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBDZGtDbGlXcmFwcGVyT3B0aW9ucykge1xuICAgIHRoaXMuZGlyZWN0b3J5ID0gb3B0aW9ucy5kaXJlY3Rvcnk7XG4gICAgdGhpcy5lbnYgPSBvcHRpb25zLmVudjtcbiAgICB0aGlzLnNob3dPdXRwdXQgPSBvcHRpb25zLnNob3dPdXRwdXQgPz8gZmFsc2U7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuY2RrID0gb3B0aW9ucy5jZGtFeGVjdXRhYmxlID8/ICdjZGsnO1xuICAgIH0gY2F0Y2gge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBjb3VsZCBub3QgcmVzb2x2ZSBwYXRoIHRvIGNkayBleGVjdXRhYmxlOiBcIiR7b3B0aW9ucy5jZGtFeGVjdXRhYmxlID8/ICdjZGsnfVwiYCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB2YWxpZGF0ZUFyZ3Mob3B0aW9uczogRGVmYXVsdENka09wdGlvbnMpOiB2b2lkIHtcbiAgICBpZiAoIW9wdGlvbnMuc3RhY2tzICYmICFvcHRpb25zLmFsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdvbmUgb2YgXCJhcHBcIiBvciBcInN0YWNrc1wiIG11c3QgYmUgcHJvdmlkZWQnKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgbGlzdChvcHRpb25zOiBMaXN0T3B0aW9ucyk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCBsaXN0Q29tbWFuZEFyZ3M6IHN0cmluZ1tdID0gW1xuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnbG9uZycsIG9wdGlvbnMubG9uZyksXG4gICAgICAuLi50aGlzLmNyZWF0ZURlZmF1bHRBcmd1bWVudHMob3B0aW9ucyksXG4gICAgXTtcblxuICAgIHJldHVybiBleGVjKFt0aGlzLmNkaywgJ2xzJywgLi4ubGlzdENvbW1hbmRBcmdzXSwge1xuICAgICAgY3dkOiB0aGlzLmRpcmVjdG9yeSxcbiAgICAgIHZlcmJvc2U6IHRoaXMuc2hvd091dHB1dCxcbiAgICAgIGVudjogdGhpcy5lbnYsXG4gICAgfSkuc3BsaXQoJ1xcbicpO1xuICB9XG4gIC8qKlxuICAgKiBjZGsgZGVwbG95XG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZGVwbG95KG9wdGlvbnM6IERlcGxveU9wdGlvbnMpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBkZXBsb3lDb21tYW5kQXJnczogc3RyaW5nW10gPSBbXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdjaScsIG9wdGlvbnMuY2kpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnZXhlY3V0ZScsIG9wdGlvbnMuZXhlY3V0ZSksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdleGNsdXNpdmVseScsIG9wdGlvbnMuZXhjbHVzaXZlbHkpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnZm9yY2UnLCBvcHRpb25zLmZvcmNlKSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ3ByZXZpb3VzLXBhcmFtZXRlcnMnLCBvcHRpb25zLnVzZVByZXZpb3VzUGFyYW1ldGVycyksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdyb2xsYmFjaycsIG9wdGlvbnMucm9sbGJhY2spLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnc3RhZ2luZycsIG9wdGlvbnMuc3RhZ2luZyksXG4gICAgICAuLi5vcHRpb25zLnJldXNlQXNzZXRzID8gcmVuZGVyQXJyYXlBcmcoJy0tcmV1c2UtYXNzZXRzJywgb3B0aW9ucy5yZXVzZUFzc2V0cykgOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMubm90aWZpY2F0aW9uQXJucyA/IHJlbmRlckFycmF5QXJnKCctLW5vdGlmaWNhdGlvbi1hcm5zJywgb3B0aW9ucy5ub3RpZmljYXRpb25Bcm5zKSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5wYXJhbWV0ZXJzID8gcmVuZGVyTWFwQXJyYXlBcmcoJy0tcGFyYW1ldGVycycsIG9wdGlvbnMucGFyYW1ldGVycykgOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMub3V0cHV0c0ZpbGUgPyBbJy0tb3V0cHV0cy1maWxlJywgb3B0aW9ucy5vdXRwdXRzRmlsZV0gOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMucmVxdWlyZUFwcHJvdmFsID8gWyctLXJlcXVpcmUtYXBwcm92YWwnLCBvcHRpb25zLnJlcXVpcmVBcHByb3ZhbF0gOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMuY2hhbmdlU2V0TmFtZSA/IFsnLS1jaGFuZ2Utc2V0LW5hbWUnLCBvcHRpb25zLmNoYW5nZVNldE5hbWVdIDogW10sXG4gICAgICAuLi5vcHRpb25zLnRvb2xraXRTdGFja05hbWUgPyBbJy0tdG9vbGtpdC1zdGFjay1uYW1lJywgb3B0aW9ucy50b29sa2l0U3RhY2tOYW1lXSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5wcm9ncmVzcyA/IFsnLS1wcm9ncmVzcycsIG9wdGlvbnMucHJvZ3Jlc3NdIDogWyctLXByb2dyZXNzJywgU3RhY2tBY3Rpdml0eVByb2dyZXNzLkVWRU5UU10sXG4gICAgICAuLi5vcHRpb25zLmRlcGxveW1lbnRNZXRob2QgPyBbJy0tbWV0aG9kJywgb3B0aW9ucy5kZXBsb3ltZW50TWV0aG9kXSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5jb25jdXJyZW5jeSA/IFsnLS1jb25jdXJyZW5jeScsIG9wdGlvbnMuY29uY3VycmVuY3kudG9TdHJpbmcoKV0gOiBbXSxcbiAgICAgIC4uLnRoaXMuY3JlYXRlRGVmYXVsdEFyZ3VtZW50cyhvcHRpb25zKSxcbiAgICBdO1xuXG4gICAgZXhlYyhbdGhpcy5jZGssICdkZXBsb3knLCAuLi5kZXBsb3lDb21tYW5kQXJnc10sIHtcbiAgICAgIGN3ZDogdGhpcy5kaXJlY3RvcnksXG4gICAgICB2ZXJib3NlOiB0aGlzLnNob3dPdXRwdXQsXG4gICAgICBlbnY6IHRoaXMuZW52LFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIHdhdGNoKG9wdGlvbnM6IERlcGxveU9wdGlvbnMsIGV2ZW50czogV2F0Y2hFdmVudHMgPSB7fSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGxldCBob3Rzd2FwOiBzdHJpbmc7XG4gICAgc3dpdGNoIChvcHRpb25zLmhvdHN3YXApIHtcbiAgICAgIGNhc2UgSG90c3dhcE1vZGUuRkFMTF9CQUNLOlxuICAgICAgICBob3Rzd2FwID0gJy0taG90c3dhcC1mYWxsYmFjayc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBIb3Rzd2FwTW9kZS5IT1RTV0FQX09OTFk6XG4gICAgICAgIGhvdHN3YXAgPSAnLS1ob3Rzd2FwJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBob3Rzd2FwID0gJy0taG90c3dhcC1mYWxsYmFjayc7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjb25zdCBkZXBsb3lDb21tYW5kQXJnczogc3RyaW5nW10gPSBbXG4gICAgICAnLS13YXRjaCcsXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdjaScsIG9wdGlvbnMuY2kpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnZXhlY3V0ZScsIG9wdGlvbnMuZXhlY3V0ZSksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdleGNsdXNpdmVseScsIG9wdGlvbnMuZXhjbHVzaXZlbHkpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnZm9yY2UnLCBvcHRpb25zLmZvcmNlKSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ3ByZXZpb3VzLXBhcmFtZXRlcnMnLCBvcHRpb25zLnVzZVByZXZpb3VzUGFyYW1ldGVycyksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdyb2xsYmFjaycsIG9wdGlvbnMucm9sbGJhY2spLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnc3RhZ2luZycsIG9wdGlvbnMuc3RhZ2luZyksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdsb2dzJywgb3B0aW9ucy50cmFjZUxvZ3MpLFxuICAgICAgaG90c3dhcCxcbiAgICAgIC4uLm9wdGlvbnMucmV1c2VBc3NldHMgPyByZW5kZXJBcnJheUFyZygnLS1yZXVzZS1hc3NldHMnLCBvcHRpb25zLnJldXNlQXNzZXRzKSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5ub3RpZmljYXRpb25Bcm5zID8gcmVuZGVyQXJyYXlBcmcoJy0tbm90aWZpY2F0aW9uLWFybnMnLCBvcHRpb25zLm5vdGlmaWNhdGlvbkFybnMpIDogW10sXG4gICAgICAuLi5vcHRpb25zLnBhcmFtZXRlcnMgPyByZW5kZXJNYXBBcnJheUFyZygnLS1wYXJhbWV0ZXJzJywgb3B0aW9ucy5wYXJhbWV0ZXJzKSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5vdXRwdXRzRmlsZSA/IFsnLS1vdXRwdXRzLWZpbGUnLCBvcHRpb25zLm91dHB1dHNGaWxlXSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5yZXF1aXJlQXBwcm92YWwgPyBbJy0tcmVxdWlyZS1hcHByb3ZhbCcsIG9wdGlvbnMucmVxdWlyZUFwcHJvdmFsXSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5jaGFuZ2VTZXROYW1lID8gWyctLWNoYW5nZS1zZXQtbmFtZScsIG9wdGlvbnMuY2hhbmdlU2V0TmFtZV0gOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMudG9vbGtpdFN0YWNrTmFtZSA/IFsnLS10b29sa2l0LXN0YWNrLW5hbWUnLCBvcHRpb25zLnRvb2xraXRTdGFja05hbWVdIDogW10sXG4gICAgICAuLi5vcHRpb25zLnByb2dyZXNzID8gWyctLXByb2dyZXNzJywgb3B0aW9ucy5wcm9ncmVzc10gOiBbJy0tcHJvZ3Jlc3MnLCBTdGFja0FjdGl2aXR5UHJvZ3Jlc3MuRVZFTlRTXSxcbiAgICAgIC4uLm9wdGlvbnMuZGVwbG95bWVudE1ldGhvZCA/IFsnLS1tZXRob2QnLCBvcHRpb25zLmRlcGxveW1lbnRNZXRob2RdIDogW10sXG4gICAgICAuLi50aGlzLmNyZWF0ZURlZmF1bHRBcmd1bWVudHMob3B0aW9ucyksXG4gICAgXTtcblxuICAgIGNvbnN0IGNoaWxkID0gd2F0Y2goW3RoaXMuY2RrLCAnZGVwbG95JywgLi4uZGVwbG95Q29tbWFuZEFyZ3NdLCB7XG4gICAgICBjd2Q6IHRoaXMuZGlyZWN0b3J5LFxuICAgICAgdmVyYm9zZTogdGhpcy5zaG93T3V0cHV0LFxuICAgICAgZW52OiB0aGlzLmVudixcbiAgICB9KTtcblxuICAgIGlmIChldmVudHMub25TdGRvdXQpIHtcbiAgICAgIGNoaWxkLnN0ZG91dD8ub24oJ2RhdGEnLCBldmVudHMub25TdGRvdXQpO1xuICAgIH1cbiAgICBpZiAoZXZlbnRzLm9uU3RkZXJyKSB7XG4gICAgICBjaGlsZC5zdGRlcnI/Lm9uKCdkYXRhJywgZXZlbnRzLm9uU3RkZXJyKTtcbiAgICB9XG5cbiAgICBjaGlsZC5vbignY2xvc2UnLCAoY29kZSkgPT4ge1xuICAgICAgY2hpbGQuc3RkaW4/LmVuZCgpO1xuICAgICAgaWYgKGV2ZW50cy5vbkNsb3NlKSB7XG4gICAgICAgIGV2ZW50cy5vbkNsb3NlKGNvZGUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIGNkayBkZXN0cm95XG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZGVzdHJveShvcHRpb25zOiBEZXN0cm95T3B0aW9ucyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGRlc3Ryb3lDb21tYW5kQXJnczogc3RyaW5nW10gPSBbXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdmb3JjZScsIG9wdGlvbnMuZm9yY2UpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnZXhjbHVzaXZlbHknLCBvcHRpb25zLmV4Y2x1c2l2ZWx5KSxcbiAgICAgIC4uLnRoaXMuY3JlYXRlRGVmYXVsdEFyZ3VtZW50cyhvcHRpb25zKSxcbiAgICBdO1xuXG4gICAgZXhlYyhbdGhpcy5jZGssICdkZXN0cm95JywgLi4uZGVzdHJveUNvbW1hbmRBcmdzXSwge1xuICAgICAgY3dkOiB0aGlzLmRpcmVjdG9yeSxcbiAgICAgIHZlcmJvc2U6IHRoaXMuc2hvd091dHB1dCxcbiAgICAgIGVudjogdGhpcy5lbnYsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogY2RrIHN5bnRoXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc3ludGgob3B0aW9uczogU3ludGhPcHRpb25zKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qgc3ludGhDb21tYW5kQXJnczogc3RyaW5nW10gPSBbXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCd2YWxpZGF0aW9uJywgb3B0aW9ucy52YWxpZGF0aW9uKSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ3F1aWV0Jywgb3B0aW9ucy5xdWlldCksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdleGNsdXNpdmVseScsIG9wdGlvbnMuZXhjbHVzaXZlbHkpLFxuICAgICAgLi4udGhpcy5jcmVhdGVEZWZhdWx0QXJndW1lbnRzKG9wdGlvbnMpLFxuICAgIF07XG5cbiAgICBleGVjKFt0aGlzLmNkaywgJ3N5bnRoJywgLi4uc3ludGhDb21tYW5kQXJnc10sIHtcbiAgICAgIGN3ZDogdGhpcy5kaXJlY3RvcnksXG4gICAgICB2ZXJib3NlOiB0aGlzLnNob3dPdXRwdXQsXG4gICAgICBlbnY6IHRoaXMuZW52LFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIERvIGEgQ0RLIHN5bnRoLCBtaW1pY2tpbmcgdGhlIENMSSAod2l0aG91dCBhY3R1YWxseSB1c2luZyBpdClcbiAgICpcbiAgICogVGhlIENMSSBoYXMgYSBwcmV0dHkgc2xvdyBzdGFydHVwIHRpbWUgYmVjYXVzZSBvZiBhbGwgdGhlIG1vZHVsZXMgaXQgbmVlZHMgdG8gbG9hZCxcbiAgICogQnlwYXNzIGl0IHRvIGJlIHF1aWNrZXIhXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc3ludGhGYXN0KG9wdGlvbnM6IFN5bnRoRmFzdE9wdGlvbnMpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBleGVjKG9wdGlvbnMuZXhlY0NtZCwge1xuICAgICAgY3dkOiB0aGlzLmRpcmVjdG9yeSxcbiAgICAgIHZlcmJvc2U6IHRoaXMuc2hvd091dHB1dCxcbiAgICAgIGVudjoge1xuICAgICAgICBDREtfQ09OVEVYVF9KU09OOiBKU09OLnN0cmluZ2lmeShvcHRpb25zLmNvbnRleHQpLFxuICAgICAgICBDREtfT1VURElSOiBvcHRpb25zLm91dHB1dCxcbiAgICAgICAgLi4udGhpcy5lbnYsXG4gICAgICAgIC4uLm9wdGlvbnMuZW52LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRGVmYXVsdEFyZ3VtZW50cyhvcHRpb25zOiBEZWZhdWx0Q2RrT3B0aW9ucyk6IHN0cmluZ1tdIHtcbiAgICB0aGlzLnZhbGlkYXRlQXJncyhvcHRpb25zKTtcbiAgICBjb25zdCBzdGFja3MgPSBvcHRpb25zLnN0YWNrcyA/PyBbXTtcbiAgICByZXR1cm4gW1xuICAgICAgLi4ub3B0aW9ucy5hcHAgPyBbJy0tYXBwJywgb3B0aW9ucy5hcHBdIDogW10sXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdzdHJpY3QnLCBvcHRpb25zLnN0cmljdCksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCd0cmFjZScsIG9wdGlvbnMudHJhY2UpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnbG9va3VwcycsIG9wdGlvbnMubG9va3VwcyksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdpZ25vcmUtZXJyb3JzJywgb3B0aW9ucy5pZ25vcmVFcnJvcnMpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnanNvbicsIG9wdGlvbnMuanNvbiksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCd2ZXJib3NlJywgb3B0aW9ucy52ZXJib3NlKSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ2RlYnVnJywgb3B0aW9ucy5kZWJ1ZyksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdlYzJjcmVkcycsIG9wdGlvbnMuZWMyQ3JlZHMpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygndmVyc2lvbi1yZXBvcnRpbmcnLCBvcHRpb25zLnZlcnNpb25SZXBvcnRpbmcpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygncGF0aC1tZXRhZGF0YScsIG9wdGlvbnMucGF0aE1ldGFkYXRhKSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ2Fzc2V0LW1ldGFkYXRhJywgb3B0aW9ucy5hc3NldE1ldGFkYXRhKSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ25vdGljZXMnLCBvcHRpb25zLm5vdGljZXMpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnY29sb3InLCBvcHRpb25zLmNvbG9yKSxcbiAgICAgIC4uLm9wdGlvbnMuY29udGV4dCA/IHJlbmRlck1hcEFycmF5QXJnKCctLWNvbnRleHQnLCBvcHRpb25zLmNvbnRleHQpIDogW10sXG4gICAgICAuLi5vcHRpb25zLnByb2ZpbGUgPyBbJy0tcHJvZmlsZScsIG9wdGlvbnMucHJvZmlsZV0gOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMucHJveHkgPyBbJy0tcHJveHknLCBvcHRpb25zLnByb3h5XSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5jYUJ1bmRsZVBhdGggPyBbJy0tY2EtYnVuZGxlLXBhdGgnLCBvcHRpb25zLmNhQnVuZGxlUGF0aF0gOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMucm9sZUFybiA/IFsnLS1yb2xlLWFybicsIG9wdGlvbnMucm9sZUFybl0gOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMub3V0cHV0ID8gWyctLW91dHB1dCcsIG9wdGlvbnMub3V0cHV0XSA6IFtdLFxuICAgICAgLi4uc3RhY2tzLFxuICAgICAgLi4ub3B0aW9ucy5hbGwgPyBbJy0tYWxsJ10gOiBbXSxcbiAgICBdO1xuICB9XG59XG5cbmZ1bmN0aW9uIHJlbmRlck1hcEFycmF5QXJnKGZsYWc6IHN0cmluZywgcGFyYW1ldGVyczogeyBbbmFtZTogc3RyaW5nXTogc3RyaW5nIHwgdW5kZWZpbmVkIH0pOiBzdHJpbmdbXSB7XG4gIGNvbnN0IHBhcmFtczogc3RyaW5nW10gPSBbXTtcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocGFyYW1ldGVycykpIHtcbiAgICBwYXJhbXMucHVzaChgJHtrZXl9PSR7dmFsdWV9YCk7XG4gIH1cbiAgcmV0dXJuIHJlbmRlckFycmF5QXJnKGZsYWcsIHBhcmFtcyk7XG59XG5cbmZ1bmN0aW9uIHJlbmRlckFycmF5QXJnKGZsYWc6IHN0cmluZywgdmFsdWVzPzogc3RyaW5nW10pOiBzdHJpbmdbXSB7XG4gIGxldCBhcmdzOiBzdHJpbmdbXSA9IFtdO1xuICBmb3IgKGNvbnN0IHZhbHVlIG9mIHZhbHVlcyA/PyBbXSkge1xuICAgIGFyZ3MucHVzaChmbGFnLCB2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIGFyZ3M7XG59XG5cbmZ1bmN0aW9uIHJlbmRlckJvb2xlYW5BcmcodmFsOiBzdHJpbmcsIGFyZz86IGJvb2xlYW4pOiBzdHJpbmdbXSB7XG4gIGlmIChhcmcpIHtcbiAgICByZXR1cm4gW2AtLSR7dmFsfWBdO1xuICB9IGVsc2UgaWYgKGFyZyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBbYC0tbm8tJHt2YWx9YF07XG4gIH1cbn1cbiJdfQ==